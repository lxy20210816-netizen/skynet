# è„šæœ¬ä½¿ç”¨è¯´æ˜

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»å„ä¸ªè„šæœ¬çš„åŠŸèƒ½ã€å‚æ•°å’Œä½¿ç”¨æ–¹æ³•ã€‚

## ğŸ“ˆ è‚¡ç¥¨æ•°æ®é‡‡é›†è„šæœ¬

### nasdaq_pe.py - çº³æ–¯è¾¾å…‹100 PEæ¯”ç‡é‡‡é›†

**åŠŸèƒ½ï¼š** ä»GuruFocusç½‘ç«™é‡‡é›†çº³æ–¯è¾¾å…‹100æŒ‡æ•°çš„PEæ¯”ç‡æ•°æ®ã€‚

**æ•°æ®æºï¼š** https://www.gurufocus.com/

**ä½¿ç”¨æ–¹æ³•ï¼š**
```bash
source venv/bin/activate
python3 scripts/nasdaq_pe.py
```

**è¾“å‡ºæ ¼å¼ï¼š**
```json
{
  "success": true,
  "data": {
    "pe_ratio": 33.38,
    "date": "2025-10-01",
    "source": "GuruFocus",
    "timestamp": "2025-10-03T00:13:28.635885",
    "description": "Nasdaq 100 PE Ratio: 33.38 (As of 2025-10-01)"
  },
  "database_saved": true
}
```

**æ•°æ®åº“ï¼š** è‡ªåŠ¨ä¿å­˜åˆ° `finances.stock_indices` è¡¨çš„ `nasdaq_100_pe` å­—æ®µ

**ç‰¹ç‚¹ï¼š**
- ä½¿ç”¨Seleniumæ¨¡æ‹ŸçœŸå®æµè§ˆå™¨
- ç»•è¿‡åçˆ¬è™«æœºåˆ¶
- è‡ªåŠ¨é‡è¯•å’Œé”™è¯¯å¤„ç†
- æ”¯æŒæ— å¤´æ¨¡å¼è¿è¡Œ

---

### stock_indices.py - è‚¡ç¥¨æŒ‡æ•°æ•°æ®é‡‡é›†

**åŠŸèƒ½ï¼š** ä½¿ç”¨Yahoo Finance APIé‡‡é›†ä¸»è¦è‚¡ç¥¨æŒ‡æ•°çš„æ”¶ç›˜ä»·ã€‚

**é‡‡é›†æŒ‡æ•°ï¼š**
- Nasdaqç»¼åˆæŒ‡æ•° (^IXIC)
- Nasdaq 100æŒ‡æ•° (^NDX)
- æ—¥ç»225æŒ‡æ•° (^N225)
- VIXææ…ŒæŒ‡æ•° (^VIX)

**ä½¿ç”¨æ–¹æ³•ï¼š**
```bash
python3 scripts/stock_indices.py
```

**è¾“å‡ºæ ¼å¼ï¼š**
```json
{
  "success": true,
  "data": {
    "date": "2025-10-02",
    "nasdaq": 22776.828125,
    "nasdaq_100": 24821.869140625,
    "n225": 44936.73046875,
    "vix": 16.770000457763672,
    "timestamp": "2025-10-03T00:46:46.635577"
  },
  "database_saved": true
}
```

**æ•°æ®åº“ï¼š** è‡ªåŠ¨ä¿å­˜åˆ° `finances.stock_indices` è¡¨

**æ³¨æ„äº‹é¡¹ï¼š**
- è·å–çš„æ˜¯å‰ä¸€ä¸ªäº¤æ˜“æ—¥çš„æ”¶ç›˜ä»·
- æ•°æ®åº“ä¸­çš„dateå­—æ®µä¸ºè¯¥äº¤æ˜“æ—¥çš„æ—¥æœŸ
- å¦‚æœè¯¥æ—¥æœŸå·²å­˜åœ¨ï¼Œä¼šæ›´æ–°æ•°æ®è€Œä¸æ˜¯æ’å…¥æ–°è®°å½•

---

## ğŸ  æˆ¿åœ°äº§æ•°æ®é‡‡é›†è„šæœ¬

### suumo_scraper.py - Suumoæˆ¿æºçˆ¬è™«

**åŠŸèƒ½ï¼š** æŠ“å–Suumoç½‘ç«™çš„æˆ¿åœ°äº§ä¿¡æ¯ï¼ˆå½“å‰é…ç½®ä¸ºä¹°æˆ¿ä¿¡æ¯ï¼‰ã€‚

**å½“å‰é…ç½®ï¼š**
- åŒºåŸŸ: å¢¨ç”°åŒºï¼ˆé”¦ç³¸ç”ºé™„è¿‘ï¼‰
- ç±»å‹: äºŒæ‰‹å…¬å¯“ï¼ˆä¸­å¤ãƒãƒ³ã‚·ãƒ§ãƒ³ï¼‰
- é¡µæ•°: æœ€å¤š3é¡µï¼ˆçº¦90ä¸ªæˆ¿æºï¼‰

**ä½¿ç”¨æ–¹æ³•ï¼š**
```bash
python3 scripts/suumo_scraper.py > output/suumo_data.json 2>&1
```

**è¾“å‡ºå­—æ®µï¼š**
```json
{
  "building_name": "ç‰©ä»¶åç§°",
  "url": "è¯¦æƒ…é¡µé“¾æ¥",
  "price": "2590ä¸‡å††",
  "area": "34.09m2ï¼ˆ10.31åªï¼‰",
  "layout": "1LDK",
  "age": "1979å¹´2æœˆ",
  "address": "æ±äº¬éƒ½å¢¨ç”°åŒºåƒæ­³ï¼‘-1-8",
  "details": {...}
}
```

**å¯ä¿®æ”¹é…ç½®ï¼š**

åœ¨ `suumo_scraper.py` çš„ `main()` å‡½æ•°ä¸­ï¼š

```python
# ä¿®æ”¹åŒºåŸŸ
result = scrape_suumo_sale(station="éŒ¦ç³¸ç”º", max_pages=3)

# ä¿®æ”¹æœç´¢URLï¼ˆç¬¬67-74è¡Œï¼‰
# sc=13107: å¢¨ç”°åŒº
# å¯ä»¥æ”¹ä¸ºå…¶ä»–åŒºçš„ä»£ç 
```

**æ”¯æŒçš„é¡µé¢ç±»å‹ï¼š**
1. ä¹°æˆ¿é¡µé¢ï¼ˆä¸­å¤ãƒãƒ³ã‚·ãƒ§ãƒ³ï¼‰- å½“å‰é…ç½®
2. ç§Ÿæˆ¿é¡µé¢ï¼ˆè³ƒè²¸ï¼‰ - éœ€ä¿®æ”¹URL

**ç‰¹ç‚¹ï¼š**
- è‡ªåŠ¨è¯†åˆ«é¡µé¢ç±»å‹å¹¶é€‚é…æå–é€»è¾‘
- æå–å®Œæ•´çš„æˆ¿æºä¿¡æ¯ï¼ˆä»·æ ¼ã€é¢ç§¯ã€æˆ·å‹ã€å¹´é™ï¼‰
- åŒ…å«è¯¦æƒ…é¡µé“¾æ¥
- åçˆ¬è™«æœºåˆ¶
- å¯é…ç½®æ— å¤´æ¨¡å¼

---

## ğŸ“Š æ•°æ®å¯¼å‡ºè„šæœ¬

### export_to_csv.py - JSONè½¬CSV

**åŠŸèƒ½ï¼š** å°†SuumoæŠ“å–çš„JSONæ•°æ®è½¬æ¢ä¸ºCSVæ ¼å¼ï¼Œæ–¹ä¾¿å¯¼å…¥Google Sheetsã€‚

**ä½¿ç”¨æ–¹æ³•ï¼š**
```bash
python3 scripts/export_to_csv.py
```

**è¾“å‡ºæ–‡ä»¶ï¼š** `kinshicho_sale.csv`

**CSVåŒ…å«çš„åˆ—ï¼š**
- åºå·
- ç‰©ä»¶åç§°
- ä»·æ ¼(ä¸‡å††)
- å•ä»·(å††/mÂ²)
- é¢ç§¯
- é¢ç§¯(mÂ²)
- æˆ·å‹
- å»ºé€ å¹´ä»½
- æˆ¿é¾„(å¹´)
- åœ°å€
- é“¾æ¥

**å¯¼å…¥Google Sheetsæ­¥éª¤ï¼š**
1. æ‰“å¼€ Google Sheets
2. æ–‡ä»¶ â†’ å¯¼å…¥ â†’ ä¸Šä¼ 
3. é€‰æ‹©ç”Ÿæˆçš„CSVæ–‡ä»¶
4. é€‰æ‹©å¯¼å…¥ä½ç½®

---

### upload_to_gsheets.py - ç›´æ¥ä¸Šä¼ åˆ°Google Sheets

**åŠŸèƒ½ï¼š** ç›´æ¥é€šè¿‡APIä¸Šä¼ æ•°æ®åˆ°Google Sheetsï¼ˆéœ€è¦APIè®¤è¯ï¼‰ã€‚

**å‰ç½®è¦æ±‚ï¼š**
1. Google Cloudé¡¹ç›®
2. å¯ç”¨Google Sheets API
3. æœåŠ¡è´¦å·JSONå¯†é’¥ï¼ˆä¿å­˜ä¸º`credentials.json`ï¼‰

**ä½¿ç”¨æ–¹æ³•ï¼š**
```bash
python3 scripts/upload_to_gsheets.py
```

**è¾“å‡ºï¼š** åˆ›å»ºæˆ–æ›´æ–°Google Sheetsè¡¨æ ¼ï¼Œå¹¶è¿”å›è¡¨æ ¼é“¾æ¥ã€‚

---

## ğŸ—„ï¸ æ•°æ®åº“è„šæœ¬

### mysql_login.sh - MySQLç™»å½•

**åŠŸèƒ½ï¼š** å¿«é€Ÿç™»å½•MySQLæ•°æ®åº“ã€‚

**ä½¿ç”¨æ–¹æ³•ï¼š**
```bash
./scripts/mysql_login.sh
```

**é…ç½®ï¼š**
- ç”¨æˆ·å: root
- å¯†ç : 123456
- ä¸»æœº: 127.0.0.1
- ç«¯å£: 3306

---

## ğŸ”„ è‡ªåŠ¨åŒ–è¿è¡Œ

### å®šæ—¶ä»»åŠ¡ï¼ˆCrontabï¼‰

**æ¯å¤©æ—©ä¸Š9ç‚¹é‡‡é›†è‚¡ç¥¨æ•°æ®ï¼š**
```bash
0 9 * * * cd /path/to/skynet && source venv/bin/activate && python3 scripts/stock_indices.py
```

**æ¯å¤©æ—©ä¸Š9ç‚¹åŠé‡‡é›†PEæ¯”ç‡ï¼š**
```bash
30 9 * * * cd /path/to/skynet && source venv/bin/activate && python3 scripts/nasdaq_pe.py
```

### n8nå·¥ä½œæµ

è„šæœ¬è®¾è®¡ä¸ºå…¼å®¹n8nçš„Execute CommandèŠ‚ç‚¹ï¼Œå¯ä»¥ï¼š
1. åœ¨n8nä¸­åˆ›å»ºWorkflow
2. ä½¿ç”¨Execute CommandèŠ‚ç‚¹è¿è¡ŒPythonè„šæœ¬
3. è§£æJSONè¾“å‡ºå¹¶å¤„ç†
4. å‘é€é€šçŸ¥æˆ–è§¦å‘å…¶ä»–æ“ä½œ

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### çˆ¬è™«ä½¿ç”¨æ³¨æ„

1. **éµå®ˆç½‘ç«™robots.txt**
2. **åˆç†è®¾ç½®æŠ“å–é¢‘ç‡**ï¼ˆå»ºè®®é—´éš”2-3ç§’ï¼‰
3. **ä¸è¦è¿‡åº¦æŠ“å–**ï¼ˆé¿å…IPè¢«å°ï¼‰
4. **ä»…ç”¨äºä¸ªäººå­¦ä¹ å’Œç ”ç©¶**

### æ•°æ®åº“è¿æ¥

- ç¡®ä¿MySQLæœåŠ¡æ­£åœ¨è¿è¡Œ
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
- å¦‚æœä½¿ç”¨Dockerï¼Œæ³¨æ„ç½‘ç»œé…ç½®

### Chromeæµè§ˆå™¨

- Seleniuméœ€è¦Chromeæµè§ˆå™¨
- ChromeDriverä¼šè‡ªåŠ¨ä¸‹è½½
- é¦–æ¬¡è¿è¡Œå¯èƒ½è¾ƒæ…¢ï¼ˆä¸‹è½½driverï¼‰

---

## ğŸ“ è‡ªå®šä¹‰é…ç½®

### ä¿®æ”¹æ•°æ®åº“è¿æ¥

åœ¨å„è„šæœ¬ä¸­æ‰¾åˆ° `get_db_connection()` å‡½æ•°ï¼š

```python
connection = pymysql.connect(
    host='localhost',      # ä¿®æ”¹ä¸»æœº
    user='root',           # ä¿®æ”¹ç”¨æˆ·å
    password='123456',     # ä¿®æ”¹å¯†ç 
    database='finances',   # ä¿®æ”¹æ•°æ®åº“å
    charset='utf8mb4'
)
```

### ä¿®æ”¹Suumoæœç´¢æ¡ä»¶

åœ¨ `suumo_scraper.py` ä¸­ï¼š

```python
# ä¿®æ”¹åŒºåŸŸä»£ç 
sc=13107  # å¢¨ç”°åŒº
# å…¶ä»–åŒºçš„ä»£ç å¯ä»¥ä»Suumoç½‘ç«™çš„URLä¸­è·å–

# ä¿®æ”¹ç±»å‹
bs=011   # ä¸­å¤ãƒãƒ³ã‚·ãƒ§ãƒ³ï¼ˆäºŒæ‰‹å…¬å¯“ï¼‰
bs=040   # è³ƒè²¸ï¼ˆç§Ÿæˆ¿ï¼‰
```

---

## ğŸ› è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

```bash
python3 scripts/nasdaq_pe.py 2>&1 | tee debug.log
```

### æµ‹è¯•Selenium

```python
# å–æ¶ˆheadlessæ¨¡å¼æŸ¥çœ‹æµè§ˆå™¨æ“ä½œ
chrome_options.add_argument("--headless")  # æ³¨é‡Šæ‰è¿™è¡Œ
```

### æ£€æŸ¥æ•°æ®åº“

```bash
./scripts/mysql_login.sh
# ç„¶åæ‰§è¡ŒSQLæŸ¥è¯¢
SELECT * FROM stock_indices ORDER BY date DESC LIMIT 5;
```

