# Scripts è„šæœ¬è¯´æ˜

æœ¬ç›®å½•åŒ…å«æ‰€æœ‰æ•°æ®é‡‡é›†å’Œå¤„ç†è„šæœ¬ã€‚

## ğŸ“‚ è„šæœ¬åˆ—è¡¨

### ğŸ“ˆ é‡‘èæ•°æ®é‡‡é›†

| è„šæœ¬ | åŠŸèƒ½ | æ•°æ®æº | è¾“å‡º |
|-----|------|--------|------|
| `nasdaq_pe.py` | çº³æ–¯è¾¾å…‹100 PEæ¯”ç‡ | GuruFocus | JSON + MySQL |
| `stock_indices.py` | è‚¡ç¥¨æŒ‡æ•°æ”¶ç›˜ä»· | Yahoo Finance | JSON + MySQL |

### ğŸ  æˆ¿åœ°äº§æ•°æ®é‡‡é›†

| è„šæœ¬ | åŠŸèƒ½ | æ•°æ®æº | è¾“å‡º |
|-----|------|--------|------|
| `suumo_scraper.py` | Suumoæˆ¿æºä¿¡æ¯ | Suumo.jp | JSON |
| `export_to_csv.py` | JSONè½¬CSV | æœ¬åœ°JSON | CSVæ–‡ä»¶ |
| `upload_to_gsheets.py` | ä¸Šä¼ åˆ°Google Sheets | æœ¬åœ°JSON | Google Sheets |

### ğŸ”§ å·¥å…·è„šæœ¬

| è„šæœ¬ | åŠŸèƒ½ | è¯´æ˜ |
|-----|------|------|
| `mysql_login.sh` | MySQLç™»å½• | å¿«é€Ÿè¿æ¥æ•°æ®åº“ |

## ğŸš€ å¿«é€Ÿä½¿ç”¨

### 1. é‡‡é›†è‚¡ç¥¨æ•°æ®

```bash
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source ../venv/bin/activate

# é‡‡é›†è‚¡ç¥¨æŒ‡æ•°
python3 stock_indices.py

# é‡‡é›†PEæ¯”ç‡
python3 nasdaq_pe.py
```

### 2. é‡‡é›†æˆ¿æºæ•°æ®

```bash
# æŠ“å–Suumoæˆ¿æºï¼ˆè¾“å‡ºåˆ°æ–‡ä»¶ï¼‰
python3 suumo_scraper.py > ../output/suumo_$(date +%Y%m%d).json 2>&1

# è½¬æ¢ä¸ºCSV
python3 export_to_csv.py

# ç»“æœåœ¨ ../output/kinshicho_sale.csv
```

### 3. æ•°æ®åº“ç®¡ç†

```bash
# ç™»å½•MySQL
./mysql_login.sh

# æŸ¥è¯¢æœ€æ–°æ•°æ®
# SELECT * FROM stock_indices ORDER BY date DESC LIMIT 10;
```

## ğŸ“Š æ•°æ®æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ•°æ®æºç½‘ç«™      â”‚
â”‚ GuruFocus/YF    â”‚
â”‚ Suumo          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Pythonè„šæœ¬     â”‚
â”‚ *.py           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MySQLæ•°æ®åº“  â”‚  â”‚  JSON/CSV    â”‚
â”‚  finances    â”‚  â”‚  output/     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                        â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚Google Sheets â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ é…ç½®è¯´æ˜

### ä¿®æ”¹æ•°æ®åº“è¿æ¥

æ‰€æœ‰è„šæœ¬ä¸­çš„æ•°æ®åº“è¿æ¥é…ç½®ï¼š

```python
host='localhost'
user='root'
password='123456'
database='finances'
```

å¯æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ã€‚

### ä¿®æ”¹Suumoæœç´¢æ¡ä»¶

åœ¨ `suumo_scraper.py` ä¸­ä¿®æ”¹URLå‚æ•°ï¼š

```python
# ç¬¬72-74è¡Œ
base_url = "https://suumo.jp/jj/bukken/ichiran/JJ012FC001/"
params = "?ar=030&bs=011&ta=13&sc=13107&..."

# scå‚æ•°: åŒºåŸŸä»£ç 
# sc=13107  å¢¨ç”°åŒº
# sc=13113  æ¸‹è°·åŒº
# sc=13101  åƒä»£ç”°åŒº
# ç­‰ç­‰...
```

## ğŸ“… è¿è¡Œé¢‘ç‡å»ºè®®

### è‚¡ç¥¨æ•°æ®
- **è¿è¡Œæ—¶é—´ï¼š** æ¯å¤©æ—©ä¸Š9:00-10:00
- **é¢‘ç‡ï¼š** æ¯å¤©1æ¬¡
- **åŸå› ï¼š** è·å–å‰ä¸€äº¤æ˜“æ—¥æ”¶ç›˜æ•°æ®

### PEæ¯”ç‡
- **è¿è¡Œæ—¶é—´ï¼š** æ¯å¤©æ—©ä¸Š9:30
- **é¢‘ç‡ï¼š** æ¯å¤©1æ¬¡
- **åŸå› ï¼š** GuruFocusé€šå¸¸åœ¨ç¾è‚¡æ”¶ç›˜åæ›´æ–°

### æˆ¿æºæ•°æ®
- **è¿è¡Œæ—¶é—´ï¼š** æ¯å‘¨æˆ–æ¯æœˆ
- **é¢‘ç‡ï¼š** æ ¹æ®éœ€æ±‚
- **åŸå› ï¼š** æˆ¿æºæ›´æ–°ä¸é¢‘ç¹ï¼Œé¿å…è¿‡åº¦æŠ“å–

## âš¡ æ€§èƒ½ä¼˜åŒ–

### æ— å¤´æ¨¡å¼

æ‰€æœ‰Seleniumè„šæœ¬éƒ½æ”¯æŒæ— å¤´æ¨¡å¼ï¼Œå–æ¶ˆä»¥ä¸‹è¡Œçš„æ³¨é‡Šï¼š

```python
chrome_options.add_argument("--headless")
```

### å¹¶å‘è¿è¡Œ

å¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªè„šæœ¬ï¼š

```bash
# åå°è¿è¡Œ
nohup python3 stock_indices.py > ../output/stock.log 2>&1 &
nohup python3 nasdaq_pe.py > ../output/pe.log 2>&1 &
```

## ğŸ› è°ƒè¯•æ¨¡å¼

### å¯ç”¨è¯¦ç»†æ—¥å¿—

```bash
# ä¿ç•™æ‰€æœ‰è¾“å‡º
python3 suumo_scraper.py 2>&1 | tee debug.log

# åªçœ‹å…³é”®ä¿¡æ¯
python3 suumo_scraper.py 2>&1 | grep -E "(æˆåŠŸ|å¤±è´¥|é”™è¯¯)"
```

### æµ‹è¯•æ¨¡å¼

ä¿®æ”¹ `max_pages=1` æ¥å‡å°‘æŠ“å–é‡è¿›è¡Œæµ‹è¯•ã€‚

## ğŸ“¦ ä¾èµ–ç®¡ç†

### æŸ¥çœ‹å·²å®‰è£…åŒ…

```bash
source ../venv/bin/activate
pip list
```

### å¯¼å‡ºä¾èµ–åˆ—è¡¨

```bash
pip freeze > requirements.txt
```

### å®‰è£…æ‰€æœ‰ä¾èµ–

```bash
pip install -r requirements.txt
```

## ğŸ†˜ å¸¸è§é”™è¯¯å¤„ç†

### é”™è¯¯1: æ•°æ®åº“è¿æ¥å¤±è´¥

```
æ•°æ®åº“è¿æ¥å¤±è´¥: (2003, "Can't connect to MySQL server...")
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. æ£€æŸ¥MySQLæ˜¯å¦è¿è¡Œï¼š`docker ps` æˆ– `systemctl status mysql`
2. æ£€æŸ¥ç«¯å£ï¼š`netstat -an | grep 3306`
3. æ£€æŸ¥å¯†ç æ˜¯å¦æ­£ç¡®

### é”™è¯¯2: Seleniumè¶…æ—¶

```
Message: timeout: Timed out receiving message from renderer
```

**è§£å†³æ–¹æ¡ˆï¼š**
1. å¢åŠ ç­‰å¾…æ—¶é—´ï¼š`WebDriverWait(driver, 30)`
2. æ£€æŸ¥ç½‘ç»œè¿æ¥
3. æ›´æ–°Chromeæµè§ˆå™¨

### é”™è¯¯3: ChromeDriverç‰ˆæœ¬ä¸åŒ¹é…

```
This version of ChromeDriver only supports Chrome version XX
```

**è§£å†³æ–¹æ¡ˆï¼š**
- æ›´æ–°Chromeæµè§ˆå™¨åˆ°æœ€æ–°ç‰ˆæœ¬
- æˆ–æ¸…é™¤ç¼“å­˜ï¼š`rm -rf ~/.wdm`

## ğŸ“ è·å–å¸®åŠ©

è¯¦ç»†é…ç½®è¯·å‚è€ƒï¼š[../Documents/SETUP.md](../Documents/SETUP.md)

